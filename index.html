<!DOCTYPE html>
<html>
<head>
    <title>GariTracker - Admin Panel</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; margin: 0; padding: 20px; background: #f4f4f4; }
        #map { height: 400px; width: 100%; border-radius: 10px; margin-bottom: 20px; }
        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; color: white; }
        .btn-red { background: #ff4444; }
        .btn-green { background: #00c851; }
        .btn-blue { background: #33b5e5; }
    </style>
</head>
<body>
    <h2>Live Vehicle Tracker (Car-01)</h2>
    <div id="map"></div>
    <div class="controls">
        <button class="btn-green" onclick="sendCommand('record_audio')">Start Recording</button>
        <button class="btn-red" onclick="sendCommand('stop_audio')">Stop Recording</button>
        <button class="btn-blue" onclick="sendCommand('snap_front')">Take Photo</button>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var marker = L.marker([0, 0]).addTo(map);

        // Location Update Karo
        db.ref('vehicles/Car-01').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.lat && data.lng) {
                var newPos = [data.lat, data.lng];
                marker.setLatLng(newPos);
                map.setView(newPos, 15);
            }
        });

        function sendCommand(cmd) {
            db.ref('commands/Car-01/action').set(cmd);
            alert("Command Sent: " + cmd);
        }
    </script>
</body>
</html>
