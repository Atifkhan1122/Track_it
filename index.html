<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { /* Aapki wahi purani config */ };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const map = L.map('map').setView([25.4147, 68.3442], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    const markers = {}; // Sab gariyon ke markers yahan save honge

    // Database se "vehicles" ka pura folder read karen
    onValue(ref(db, 'vehicles'), (snapshot) => {
        const vehicles = snapshot.val();
        for (let id in vehicles) {
            const v = vehicles[id];
            
            // Agar marker pehle se hai toh update karo, nahi toh naya banao
            if (markers[id]) {
                markers[id].setLatLng([v.lat, v.lng]);
            } else {
                markers[id] = L.marker([v.lat, v.lng]).addTo(map)
                    .bindPopup(`<b>Gari: ${id}</b><br>Speed: ${v.speed} km/h`);
            }
        }
    });
</script>
